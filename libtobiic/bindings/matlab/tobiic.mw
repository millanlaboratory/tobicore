% 2010-03-17  Michele Tavella <michele.tavella@epfl.ch>
$ #include <libtobiic/ICMessage.hpp>
$ #include <libtobiic/ICSerializerRapid.hpp>
$ #include <cstring>

@function [q] = tobiic_new();
	disp('[tobiic_new] Allocating')
	# ICMessage* q = new ICMessage();

@function [q] = tobiic_delete(q)
	disp('[tobiic_delete] Deleting')
	# delete(ICMessage* q);

@function [q] = tobiic_addclassifier(q, name, desc, vtype, ltype)
	disp(['[tobiic_addclassifier] Adding ' name]);
	$ void addc(ICMessage* q, std::string* name, std::string* desc, int* vtype, int* ltype) {
	$ 	ICClassifier* c = new ICClassifier(*name, *desc, *vtype, *ltype);
	$ 	q->classifiers.Add(c);
	$   q->Dump();
	$ }
	# std::string* sname = new std::string(cstring name);
	# std::string* sdesc = new std::string(cstring desc);
	# addc(ICMessage* q, std::string* sname, std::string* sdesc, int* vtype, int* ltype);

@function [q] = tobiic_addclass(q, name, label, value)
	disp(['[tobiic_addclass] Adding ' name]);
	$ void addk(ICMessage* q, std::string* name, std::string* label, float* value) {
	$	ICClassifier* c = q->classifiers.Get(*name);
	$	ICClass* k = new ICClass(*label, *value);
	$	c->classes.Add(k);
	$ }
	# std::string* sname = new std::string(cstring name);
	# std::string* slabel = new std::string(cstring label);
	# addk(ICMessage* q, std::string* sname, std::string* slabel, float* value);

@function [retval, q] = tobiic_getvalue(q, name, label)
	$ float getv(ICMessage* q, std::string* name, std::string* label) {
	$ 	return q->classifiers.Get(*name)->classes.Get(*label)->GetValue();
	$ }
	# std::string* sname = new std::string(cstring name);
	# std::string* slabel = new std::string(cstring label);
	# float retval = getv(ICMessage* q, std::string* sname, std::string* slabel);

@function [q] = tobiic_setvalue(q, name, label, value)
	$ void setv(ICMessage* q, std::string* name, std::string* label, float* value) {
	$ 	q->classifiers.Get(*name)->classes.Get(*label)->SetValue(*value);
	$ }
	# std::string* sname = new std::string(cstring name);
	# std::string* slabel = new std::string(cstring label);
	# setv(ICMessage* q, std::string* sname, std::string* slabel, float* value);

@function [retval, q] = tobiic_serialize(q)
	$ void serialize(ICMessage* q, char* buffer) {
	$ 	ICSerializerRapid rapid(q);
	$ 	rapid.SerializeCh(buffer, 4096);
	$ } 
	$
	retval = '';
	# serialize(ICMessage* q, inout cstring retval[4096]);

@function [q] = tobiic_deserialize(q, buffer)
	$ void deserialize(ICMessage* q, char* buffer) {
	$ 	ICSerializerRapid rapid(q);
	$ 	rapid.DeserializeCh(buffer, 4096);
	$ } 
	$
	# deserialize(ICMessage* q, cstring buffer[4096]);

@function [vtype] = tobiic_getvaluetype(name)
	$ int getvtype(char* buffer, int* vtype) {
	$	(*vtype) = ICClassifier::ValueType(buffer);
	$ } 
	$
	vtype = -1;
	# getvtype(cstring name, inout int* vtype);

@function [ltype] = tobiic_getlabeltype(name)
	$ int getltype(char* buffer, int* vtype) {
	$	(*vtype) = ICClassifier::LabelType(buffer);
	$ } 
	$
	ltype = -1;
	# getltype(cstring name, inout int* ltype);
